---
driver:
  name: docker
  use_sudo: false
  run_command: /lib/systemd/systemd
  cap_add:
    - SYS_ADMIN
  volume:
    - /sys/fs/cgroup

provisioner:
  name: chef_zero
  product_name: chef
  log_level: info
  deprecations_as_errors: true
  chef_license: accept-no-persist

platforms:
  - name: ubuntu-xenial
    driver_config:
      platform: ubuntu
      image: ubuntu:16.04
  - name: centos-centos6
    driver_config:
      platform: centos
      image: centos:centos6
  - name: centos-centos7
    driver_config:
      platform: centos
      image: centos:centos7

suites:
# - name: 1x-chef12
#   attributes:
#     td_agent:
#       version: 1
#   driver_config:
#     require_chef_omnibus: 12.21.3
#   excludes:
#     - ubuntu-xenial-chef12
#   run_list:
#     - recipe[smoke::default]
# - name: 2x-chef12
#   attributes:
#     td_agent:
#       version: 2.2.0
#   driver_config:
#     require_chef_omnibus: 12.21.3
#   run_list:
#     - recipe[smoke::default]
# - name: 3x-chef12
#   attributes:
#     td_agent:
#       version: 3.1.0
#   driver_config:
#     require_chef_omnibus: 12.21.3
#   run_list:
#     - recipe[smoke::default]
  - name: 2x-chef13
    attributes:
      td_agent:
        version: 2.2.0
    driver_config:
      require_chef_omnibus: false
      chef_omnibus_root: /opt/chef
      provision_command: curl -L https://omnitruck.chef.io/install.sh | bash -s -- -v 13.12.14
    provisioner:
      install_strategy: skip
    run_list:
      - recipe[smoke::default]

  - name: 3x-chef13
    attributes:
      td_agent:
        version: 3.1.0
    driver_config:
      require_chef_omnibus: false
      chef_omnibus_root: /opt/chef
      provision_command: curl -L https://omnitruck.chef.io/install.sh | bash -s -- -v 13.12.14
    provisioner:
      install_strategy: skip
    run_list:
      - recipe[smoke::default]

  - name: 4x-chef13
    attributes:
      td_agent:
        version: 4.0.1
    driver_config:
      require_chef_omnibus: false
      chef_omnibus_root: /opt/chef
      provision_command:
        - curl -L https://omnitruck.chef.io/install.sh | bash -s -- -v 13.12.14
        - /opt/chef/embedded/bin/gem install bundler:2.1.4
    provisioner:
      install_strategy: skip
    run_list:
      - recipe[smoke::default]

  - name: 4x-chef16
    attributes:
      td_agent:
        version: 4.0.1
    driver_config:
      require_chef_omnibus: false
      chef_omnibus_root: /opt/cinc
      provision_command: curl -L https://omnitruck.chef.io/install.sh | bash -s -- -v 16.13.16
    provisioner:
      install_strategy: skip
    run_list:
      - recipe[smoke::default]
